# AND・OR論理関数のエラー修正と在庫管理テンプレート

## ❌ 問題の分析

### 元の問題のあった式
```excel
=IF(AND(B2<10,"要発注", "充分"), IF(OR("季節商品", "特価商品"), "アラート", ""), "充分")
```

### エラーの原因

1. **AND関数の誤った構文**
   - `AND(B2<10,"要発注", "充分")` 
   - ❌ 第2・第3引数が文字列リテラル（論理値ではない）
   - ✅ 正しくは `AND(B2<10, E2="売れ筋")` のように論理条件のみ

2. **OR関数の誤った構文**
   - `OR("季節商品", "特価商品")`
   - ❌ 文字列リテラルを直接比較（セル参照なし）
   - ✅ 正しくは `OR(D2="季節商品", D2="特価商品")` のようにセル比較

3. **IF文の構造問題**
   - 入れ子のIF文の論理構造が不正
   - 条件と戻り値の対応関係が破綻

## ✅ 修正版の解決策

### 正しい在庫管理システムの実装

#### 1. 基本的な在庫アラート
```excel
=IF(AND(B2<10,E2="売れ筋"),"要発注","充分")
```
- **条件**: 在庫数<10 **かつ** 売れ筋商品
- **結果**: 条件満足→「要発注」、それ以外→「充分」

#### 2. 特別アラート
```excel
=IF(OR(D2="季節商品",D2="特価商品"),"要注意","通常")
```
- **条件**: 季節商品 **または** 特価商品
- **結果**: いずれか満足→「要注意」、それ以外→「通常」

#### 3. 総合判定（複合条件）
```excel
=IF(AND(B2<10,OR(D2="季節商品",E2="売れ筋")),"緊急発注",IF(B2<5,"発注検討","在庫OK"))
```
- **第1条件**: 在庫<10 **かつ** (季節商品 **または** 売れ筋)
- **第2条件**: 在庫<5
- **結果**: 第1条件→「緊急発注」、第2条件→「発注検討」、それ以外→「在庫OK」

## 📊 実装したテンプレート

### データ構造
| 列 | 内容 | 例 |
|---|---|---|
| A | 商品名 | 商品A, 商品B... |
| B | 在庫数 | 8, 15, 5... |
| C | 単価 | 1500, 2000... |
| D | 商品区分 | 季節商品, 通常商品, 特価商品 |
| E | 売れ筋 | 売れ筋, 通常 |
| F | 在庫アラート | 要発注, 充分 |
| G | 特別アラート | 要注意, 通常 |
| H | 総合判定 | 緊急発注, 発注検討, 在庫OK |

### 期待される結果
- **商品A** (在庫8, 季節商品, 売れ筋): 要発注 + 要注意 + **緊急発注**
- **商品B** (在庫15, 通常商品, 通常): 充分 + 通常 + 在庫OK
- **商品C** (在庫5, 特価商品, 売れ筋): 要発注 + 要注意 + **緊急発注**
- **商品D** (在庫20, 通常商品, 通常): 充分 + 通常 + 在庫OK
- **商品E** (在庫3, 季節商品, 通常): 充分 + 要注意 + **緊急発注**

### 集計機能
- 総在庫数: `=SUM(B2:B6)`
- 平均単価: `=AVERAGE(C2:C6)`
- 要発注件数: `=COUNTIF(F2:F6,"要発注")`
- 緊急発注件数: `=COUNTIF(H2:H6,"緊急発注")`

## 🔧 論理関数の正しい使用方法

### AND関数
```excel
=AND(条件1, 条件2, 条件3, ...)
```
- **すべての条件**がTRUEの場合にTRUEを返す
- 各引数は論理式でなければならない（文字列不可）

### OR関数
```excel
=OR(条件1, 条件2, 条件3, ...)
```
- **いずれかの条件**がTRUEの場合にTRUEを返す
- 各引数は論理式でなければならない（文字列不可）

### 文字列比較の正しい方法
```excel
セル参照="文字列"        # 正しい
="文字列"               # セル参照なしでは意味がない
```

### 複合条件の例
```excel
=IF(AND(A1>10, OR(B1="X", B1="Y")), "条件満足", "条件不満足")
```

## 🚀 使用方法

1. アプリケーションを起動: `npm run dev`
2. ブラウザで http://localhost:5174/ にアクセス
3. 「在庫管理」カテゴリを選択
4. 「商品在庫アラート管理」テンプレートを選択
5. AND・OR関数が正しく動作することを確認

## 🎯 動作確認ポイント

- [ ] AND関数で複数条件の論理積が正しく計算される
- [ ] OR関数で複数条件の論理和が正しく計算される
- [ ] IF関数との組み合わせでエラーが発生しない
- [ ] 文字列比較が正しく動作する
- [ ] COUNTIF集計関数が正しい件数を表示する
- [ ] #VALUE!エラーが発生しない

## 🛠️ 技術的改善点

1. **システムプロンプト強化**: AND・OR関数の正しい構文を追加
2. **エラーパターン明記**: よくある間違いと正しい書き方を明示
3. **テンプレート充実**: 実用的な在庫管理シナリオを実装
4. **論理関数モジュール**: 将来の手動計算に備えた基盤整備

これで、AND・OR関数による複合条件判定が正しく動作する在庫管理システムが完成しました！