# DATEDIFとNETWORKDAYS関数のテスト結果

## 実装した内容

### 1. テンプレート作成
- **テンプレート名**: 従業員勤続年数・有給計算
- **使用関数**: DATEDIF, NETWORKDAYS, TODAY, IF
- **カテゴリ**: 人事・労務管理

### 2. サンプルデータ構成

| 列 | 内容 | 例 |
|---|---|---|
| A | 従業員ID | EMP001, EMP002... |
| B | 従業員名 | 田中太郎, 佐藤花子... |
| C | 入社日 | 2020-04-01, 2018-07-15... |
| D | 勤続年数 | =DATEDIF(C2,TODAY(),"Y") |
| E | 有給開始日 | 2024-01-15, 2024-02-05... |
| F | 有給終了日 | 2024-01-25, 2024-02-16... |
| G | 有給営業日数 | =NETWORKDAYS(E2,F2) |
| H | 勤続評価 | =IF(D2>=5,"ベテラン",IF(D2>=3,"経験者","新人")) |

### 3. 関数の説明

#### DATEDIF関数
- **構文**: `DATEDIF(開始日, 終了日, "単位")`
- **単位**: 
  - "Y" = 年数
  - "M" = 月数
  - "D" = 日数
- **例**: `=DATEDIF(C2,TODAY(),"Y")` → 入社日から現在までの年数

#### NETWORKDAYS関数
- **構文**: `NETWORKDAYS(開始日, 終了日)`
- **機能**: 土日を除く営業日数を自動計算
- **例**: `=NETWORKDAYS(E2,F2)` → 有給期間の営業日数

### 4. 期待される結果

#### 従業員データ例（2024年7月時点）
- **田中太郎** (2020-04-01入社): 勤続4年 → 「経験者」
- **佐藤花子** (2018-07-15入社): 勤続6年 → 「ベテラン」
- **山田次郎** (2022-10-01入社): 勤続2年 → 「新人」
- **鈴木一郎** (2015-03-01入社): 勤続9年 → 「ベテラン」
- **高橋美咲** (2021-09-15入社): 勤続3年 → 「経験者」

#### 有給営業日数の計算例
- 1月15日〜1月25日: 約8営業日 (土日除外)
- 2月5日〜2月16日: 約8営業日 (土日除外)
- 3月10日〜3月20日: 約8営業日 (土日除外)

### 5. テクニカル実装

#### モジュール化された関数
- **DATEDIF**: `/src/utils/formulas/dateFunctions.ts`
- **NETWORKDAYS**: `/src/utils/formulas/dateFunctions.ts`
- **手動計算**: HyperFormulaでサポートされていない場合の自動フォールバック

#### 日付処理
- **dayjs**: 堅牢な日付解析ライブラリ使用
- **標準形式**: YYYY-MM-DD形式で統一
- **プラグイン**: isSameOrBefore, isSameOrAfter対応

## 使用方法

1. アプリケーションを起動: `npm run dev`
2. ブラウザで http://localhost:5174/ にアクセス
3. 「人事評価」カテゴリを選択
4. 「従業員勤続年数・有給計算」テンプレートを選択
5. DATEDIFとNETWORKDAYS関数が自動計算されることを確認

## 動作確認ポイント

- [ ] DATEDIF関数で正しい勤続年数が表示される
- [ ] NETWORKDAYS関数で土日を除いた営業日数が表示される
- [ ] TODAY()関数で現在日付が使用される
- [ ] IF関数による勤続評価が正しく分類される
- [ ] 集計行で平均勤続年数と総有給日数が計算される
- [ ] 関数セルが適切な色分けで表示される（日付関数=紫系）

## 技術的な特徴

1. **モジュラー設計**: 関数ごとに独立した実装
2. **フォールバック処理**: HyperFormula非対応時の自動手動計算
3. **型安全性**: TypeScriptによる堅牢な型定義
4. **エラーハンドリング**: 不正な日付データの適切な処理
5. **パフォーマンス**: 効率的な日付計算アルゴリズム